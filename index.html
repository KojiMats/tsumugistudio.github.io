<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TSUMUGI STUDIO</title>
  <link rel="stylesheet" href="css/style.css" />
  <meta property="og:title" content="TSUMUGI STUDIO公式サイト" />
  <meta property="og:description" content="個人開発でスマホゲームを制作するTSUMUGI STUDIOの公式サイトです。" />
  <meta property="og:image" content="https://www.tsumugistudio.com/images/ogp.png" />
  <meta property="og:url" content="https://www.tsumugistudio.com/" />
  <style>
    :root{--c:#007bff}
    body {font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; margin: 20px; background: #f9f9f9; color: #333;}
    header {margin-bottom: 20px;}
    header h1 {font-size: 24px;margin-bottom: 10px;}
    .nav-links {margin-bottom: 20px;}
    .nav-links a {margin-right: 15px;text-decoration: none;color: var(--c);font-weight: 600;font-size: 14px}
    .nav-links a:hover {text-decoration: underline}

    /* Language tabs */
    .tabs {border-bottom: 1px solid #ccc; display: flex; gap:6px; margin-bottom: 20px}
    .tab {padding: 8px 16px; cursor: pointer; background: #f1f1f1; border: 1px solid #ccc; border-bottom: none; border-radius: 4px 4px 0 0; font-size: 14px; color: #333}
    .tab.active {background: #fff; color: #000; font-weight: 700; border-bottom: 1px solid #fff}
    .tab:focus{outline:2px solid var(--c); outline-offset:2px}
    [role="tabpanel"] {display:none}
    .tab-content.active,[role="tabpanel"].active{display:block}

    img {max-width: 100%; height: auto; border: 1px solid #ccc; margin-top: 10px}
    footer {text-align: center; margin-top: 40px; color: #666; font-size: 14px; padding: 20px}

    /* region tabs */
    .region-tabs{display:flex;gap:6px;border-bottom:1px solid #ccc;margin:14px 0;flex-wrap:wrap}
    .region-tab{padding:6px 10px;cursor:pointer;background:#f2f5f8;border:1px solid #ccc;border-bottom:none;border-radius:4px 4px 0 0;font-size:13px}
    .region-tab.active{background:#fff;font-weight:700}
    .region-tab:focus{outline:2px solid var(--c); outline-offset:2px}
    .region-panel{display:none;padding:14px 16px;background:#fff;border:1px solid #ccc;border-radius:0 4px 4px 4px}
    .region-panel.active{display:block}
    .badge{display:inline-block;font-size:12px;border:1px solid #ddd;border-radius:12px;padding:2px 8px;margin-left:6px}
    .badge.ok{background:#e8f8ef;border-color:#bfe9cf;color:#2a7d4f}
    .badge.soon{background:#fff5e6;border-color:#ffd9a6;color:#8a5a00}
    .links a{margin-right:10px}
    .note-small{color:#666;font-size:13px}

    /* 共通（スマホ縦長などは全幅） */
    .hero-video {
      width: 100%;
      height: auto;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    
    /* 画面が横長のときは横幅を約1/3に、左寄せのまま */
    @media (min-aspect-ratio: 4/3) {
      .hero-video {
        max-width: 33%;
        margin-left: 0;     /* 念のため左寄せを明示 */
        margin-right: 0;
      }
    }

    .social-links {
      margin-top: 12px;
      display: flex;
      justify-content: center;
      gap: 16px;
    }
    .social-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      text-decoration: none;
      font-size: 14px;
      background: #fff;
      border: 1px solid #ddd;
      color: #111;
      transition: background .2s, transform .2s;
    }
    .social-link:hover {
      background: #f5f5f5;
      transform: translateY(-2px);
    }
    .social-link svg {
      fill: currentColor;
    }
    @media (prefers-color-scheme: dark) {
      .social-link {
        background: #111;
        border-color: #333;
        color: #f3f3f3;
      }
      .social-link:hover {
        background: #222;
      }
    }
    
    /* --- Update Notice --- */
    .notice{border:1px solid #ffd9a6;background:#fff9ed;padding:12px 14px;border-radius:8px;margin:12px 0}
    .notice .title{font-weight:700;margin-bottom:6px}
    .notice .meta{font-size:13px;color:#555;margin-top:4px}
    .notice a.btn{display:inline-block;margin-top:8px;padding:6px 10px;border-radius:999px;border:1px solid #ddd;text-decoration:none}
    .notice a.btn:hover{background:#f5f5f5}
    
  </style>
</head>
<body>
  <header>
    <h1>TSUMUGI STUDIO</h1>

    <!-- ナビ -->
    <nav class="nav-links" aria-label="Primary">
      <a href="index.html">Home</a>
      <a href="streaming-guideline.html">Guidelines</a>
      <a href="privacy.html">Privacy Policy</a>
      <a href="contact.html">Contact</a>
    </nav>

    <!-- 言語タブ（ARIA対応） -->
    <div class="tabs" role="tablist" aria-label="Language">
      <button class="tab active" role="tab" aria-selected="true" aria-controls="content-ja" id="tab-ja">日本語</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="content-en" id="tab-en">English</button>
    </div>
  </header>

  <main>
    <!-- 日本語 -->
    <section class="tab-content active" id="content-ja" role="tabpanel" aria-labelledby="tab-ja">
      
      <!-- ★ Update Notice (JA) -->
      <div class="notice" role="status" aria-live="polite">
        <div class="title">🔔【重要】「Unityで制作されたゲームやアプリのセキュリティ脆弱性」への対応について</div>
        <div>
          <p>2025年10月3日(金)にUnity Technologiesより発表のあった「Unityで制作されたゲームやアプリのセキュリティ脆弱性 <a href="https://unity.com/ja/security/sept-2025-01">CVE-2025-59489</a>」について、修正パッチを適用させた(Ver.1.0.387)を10月4日に公開いたしました。</p>
          <p>脱出ゲーム「路地裏からの脱出」ご利用のみなさまにおかれましては、必ず最新のアプリにアップデートしていただき、ゲームををお楽しみください。</p>
          <p>今後とも「路地裏からの脱出」をよろしくお願いいたします。</p>
        </div>
        <div class="meta">※ ゲーム内容に変更はありません（安全性向上のための更新です）。</div>
        <a class="btn" href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape" target="_blank" rel="noopener">Google Playでアップデート</a>
      </div>
     
      <h2>世界各国で配信開始（2025年8月25日）</h2>
      <p>謎解き脱出ゲーム『路地裏からの脱出』が、各国のGoogle Playで配信開始しました。</p>
      <p>美しく作り込まれた路地裏を探索し、謎を解いて脱出する本作は、ちょっとした空き時間にも楽しめる内容になっています。</p>
      <p>Androidをお使いの皆様、遊んでいただけると嬉しいです。</p>
      <!-- <img src="images/HiddenAlleyEscape-Playing.png" alt="ゲーム画面のスクリーンショット" /> -->
      <video class="hero-video"  src="movie/UAC-W-01-Song-JP_mini.mp4"  playsinline  muted  loop  preload="none"  poster="images/HiddenAlleyEscape-Playing.png"></video>
      
      <!-- 国別情報（日本語） -->
      <h2>配信状況・プレス</h2>

      <div class="region-tabs" role="tablist" aria-label="Regions (JA)" data-scope="ja">
        <button class="region-tab active" role="tab" aria-selected="true" aria-controls="ja-panel-jp" id="ja-tab-jp" data-region="jp">日本</button>
        <button class="region-tab" role="tab" aria-selected="false" aria-controls="ja-panel-en" id="ja-tab-en-region" data-region="en">English</button>
        <button class="region-tab" role="tab" aria-selected="false" aria-controls="ja-panel-hk" id="ja-tab-hk" data-region="hk">香港</button>
        <button class="region-tab" role="tab" aria-selected="false" aria-controls="ja-panel-tw" id="ja-tab-tw" data-region="tw">台湾</button>
        <button class="region-tab" role="tab" aria-selected="false" aria-controls="ja-panel-kr" id="ja-tab-kr" data-region="kr">韓国</button>
      </div>

      <!-- 日本（配信中） -->
      <div class="region-panel" id="ja-panel-jp" role="tabpanel" aria-labelledby="ja-tab-jp">
        <p><strong>配信状況</strong>
          <span class="badge ok">配信中（<span class="date-ja" data-date="2025-08-25"></span>）</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=ja-JP&gl=JP" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Google Playで手に入れよう" style="height:60px; border:none;">
          </a>
        </p>
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/JP/250826_PR_EscapeGame_TheHiddenAlley_JP.pdf" target="_blank" rel="noopener">プレスリリース（日本向け）</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/JP/presskit-jp.zip" target="_blank" rel="noopener">プレスキット（日本向け）</a>
        </p>
      </div>

      <!-- English（配信中） -->
      <div class="region-panel" id="ja-panel-en" role="tabpanel" aria-labelledby="ja-tab-en-region">
        <p><strong>配信状況</strong>
          <span class="badge ok">配信中（<span class="date-ja" data-date="2025-08-25"></span>）</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=en-US&gl=US" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Google Playで手に入れよう" style="height:60px; border:none;">
          </a>
        </p>
        <!--
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/EN/250826_PR_EscapeGame_TheHiddenAlley_EN.pdf" target="_blank" rel="noopener">プレスリリース（英語版）</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/EN/presskit-en.zip" target="_blank" rel="noopener">プレスキット（英語版）</a>
        </p>
        -->
      </div>

      <!-- 香港（配信中） -->
      <div class="region-panel active" id="ja-panel-hk" role="tabpanel" aria-labelledby="ja-tab-hk">
        <p><strong>配信状況</strong>
          <span class="badge ok">配信中（<span class="date-ja" data-date="2025-08-12"></span>）</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=zh-HK&gl=HK" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Google Playで手に入れよう" style="height:60px; border:none;">
          </a>
        </p>
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/HK/250813_PR_EscapeGame_TheHiddenAlley_HK.pdf" target="_blank" rel="noopener">プレスリリース（香港向け）</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/HK/presskit-tc.zip" target="_blank" rel="noopener">プレスキット（香港向け）</a>
        </p>
      </div>

      <!-- 台湾（配信中） -->
      <div class="region-panel" id="ja-panel-tw" role="tabpanel" aria-labelledby="ja-tab-tw">
        <p><strong>配信状況</strong>
          <span class="badge ok">配信中（<span class="date-ja" data-date="2025-08-25"></span>）</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=zh-TW&gl=TW" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Google Playで手に入れよう" style="height:60px; border:none;">
          </a>
        </p>
        <!--
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/TW/250826_PR_EscapeGame_TheHiddenAlley_TW.pdf" target="_blank" rel="noopener">プレスリリース（台湾向け）</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/TW/presskit-tw.zip" target="_blank" rel="noopener">プレスキット（台湾向け）</a>
        </p>
        -->
      </div>

      <!-- 韓国（配信中） -->
      <div class="region-panel" id="ja-panel-kr" role="tabpanel" aria-labelledby="ja-tab-kr">
        <p><strong>配信状況</strong>
          <span class="badge ok">配信中（<span class="date-ja" data-date="2025-08-25"></span>）</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=ko-KR&gl=KR" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Google Playで手に入れよう" style="height:60px; border:none;">
          </a>
        </p>
        <!--
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/KR/250826_PR_EscapeGame_TheHiddenAlley_KR.pdf" target="_blank" rel="noopener">プレスリリース（韓国向け）</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/KR/presskit-kr.zip" target="_blank" rel="noopener">プレスキット（韓国向け）</a>
        </p>
        -->
      </div>

    </section>

    <!-- 英語 -->
    <section class="tab-content" id="content-en" role="tabpanel" aria-labelledby="tab-en" lang="en">
      <!-- ★ Update Notice (EN) -->
      <div class="notice" role="status" aria-live="polite">
        <div class="title">🔔 [Important] Update Regarding "Security Vulnerability in Games and Apps Built with Unity for Android"</div>
        <div>
          <p>On October 3, 2025 (Fri), Unity Technologies announced a security vulnerability affecting games and apps built with Unity (<a href="https://unity.com/security/sept-2025-01">CVE-2025-59489</a>). We have applied the official security patch and released the updated version (Ver.1.0.387) on October 4.</p>
          <p>If you are playing <strong>Escape Game: The Hidden Alley</strong>, please make sure to update to the latest version to continue enjoying the game safely.</p>
          <p>Thank you for your continued support of <strong>Escape Game: The Hidden Alley</strong>.</p>
        </div>
        <div class="meta">※ No changes have been made to the game content (this update is for security improvement only).</div>
        <a class="btn" href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape" target="_blank" rel="noopener">Update on Google Play</a>
      </div>
      
      <h2>Now Available on Google Play (Launched on August 25, 2025)</h2>
      <p>The escape game <em>The Hidden Alley: Escape</em> is now available on Google Play in several countries worldwide.</p>
      <!-- < img src="images/HiddenAlleyEscape-Playing.png" alt="Screenshot of the game screen" /> -->
      <video class="hero-video"   src="movie/UAC-W-01-Song-EN_mini.mp4"  playsinline muted loop preload="none"   poster="images/HiddenAlleyEscape-Playing.png"></video>

      <!-- Region info (English) -->
      <h2>Release & Press</h2>

      <div class="region-tabs" role="tablist" aria-label="Regions (EN)" data-scope="en">
        <button class="region-tab" role="tab" aria-selected="false" aria-controls="en-panel-jp" id="en-tab-jp" data-region="jp">Japan</button>
        <button class="region-tab active" role="tab" aria-selected="true" aria-controls="en-panel-en" id="en-tab-en-region" data-region="en">English</button>
        <button class="region-tab" role="tab" aria-selected="false" aria-controls="en-panel-hk" id="en-tab-hk" data-region="hk">Hong Kong</button>
        <button class="region-tab" role="tab" aria-selected="false" aria-controls="en-panel-tw" id="en-tab-tw" data-region="tw">Taiwan</button>
        <button class="region-tab" role="tab" aria-selected="false" aria-controls="en-panel-kr" id="en-tab-kr" data-region="kr">Korea</button>
      </div>

      <!-- Japan -->
      <div class="region-panel" id="en-panel-jp" role="tabpanel" aria-labelledby="en-tab-jp">
        <p><strong>Status</strong>
          <span class="badge ok">Released (<span class="date-en" data-date="2025-08-25"></span>)</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=ja-JP&gl=JP" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Get it on Google Play" style="height:60px; border:none;">
          </a>
        </p>
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/JP/250826_PR_EscapeGame_TheHiddenAlley_JP.pdf" target="_blank" rel="noopener">Press Release (JP)</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/JP/presskit-jp.zip" target="_blank" rel="noopener">Press Kit (JP)</a>
        </p>
      </div>

      <!-- English -->
      <div class="region-panel" id="en-panel-en" role="tabpanel" aria-labelledby="en-tab-en-region">
        <p><strong>Status</strong>
          <span class="badge ok">Released (<span class="date-en" data-date="2025-08-25"></span>)</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=en-US&gl=US" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Get it on Google Play" style="height:60px; border:none;">
          </a>
        </p>
        <!--
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/EN/250826_PR_EscapeGame_TheHiddenAlley_EN.pdf" target="_blank" rel="noopener">Press Release (EN)</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/EN/presskit-en.zip" target="_blank" rel="noopener">Press Kit (EN)</a>
        </p>
        -->
      </div>
      
      <!-- Hong Kong (Released) -->
      <div class="region-panel active" id="en-panel-hk" role="tabpanel" aria-labelledby="en-tab-hk">
        <p><strong>Status</strong>
          <span class="badge ok">Released (<span class="date-en" data-date="2025-08-12"></span>)</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=zh-HK&gl=HK" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Get it on Google Play" style="height:60px; border:none;">
          </a>
        </p>
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/HK/250813_PR_EscapeGame_TheHiddenAlley_HK.pdf" target="_blank" rel="noopener">Press Release (HK)</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/HK/presskit-tc.zip" target="_blank" rel="noopener">Press Kit (HK)</a>
        </p>
      </div>

      <!-- Taiwan -->
      <div class="region-panel" id="en-panel-tw" role="tabpanel" aria-labelledby="en-tab-tw">
        <p><strong>Status</strong>
          <span class="badge ok">Released (<span class="date-en" data-date="2025-08-25"></span>)</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=zh-TW&gl=TW" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Get it on Google Play" style="height:60px; border:none;">
          </a>
        </p>
        <!--
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/TW/250826_PR_EscapeGame_TheHiddenAlley_TW.pdf" target="_blank" rel="noopener">Press Release (TW)</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/TW/presskit-tw.zip" target="_blank" rel="noopener">Press Kit (TW)</a>
        </p>
        -->
      </div>

      <!-- Korea -->
      <div class="region-panel" id="en-panel-kr" role="tabpanel" aria-labelledby="en-tab-kr">
        <p><strong>Status</strong>
          <span class="badge ok">Released (<span class="date-en" data-date="2025-08-25"></span>)</span>
        </p>
        <p class="links">
          <a href="https://play.google.com/store/apps/details?id=com.tsumugistudio.hiddenalleyescape&hl=ko-KR&gl=KR" target="_blank" rel="noopener">
            <img src="images/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Get it on Google Play" style="height:60px; border:none;">
          </a>
        </p>
        <!--
        <p class="links">
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/KR/250826_PR_EscapeGame_TheHiddenAlley_KR.pdf" target="_blank" rel="noopener">Press Release (KR)</a>
          <a href="https://www.tsumugistudio.com/press/the-hidden-alley/KR/presskit-kr.zip" target="_blank" rel="noopener">Press Kit (KR)</a>
        </p>
        -->
      </div>

    </section>
  </main>

  <footer>
    <p>&copy; 2025 TSUMUGI STUDIO</p>
    <div class="social-links">
    <a class="social-link" href="https://x.com/Tsumugi_Studio" target="_blank" rel="noopener" aria-label="X">
      <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
        <path d="M18.244 2H21l-6.5 7.43L22.5 22H15.9l-4.66-6.1L6 22H3.244l7.026-8.03L1.5 2H8.1l4.19 5.66L18.244 2Zm-1.17 18h1.77L7.014 4h-1.77L17.074 20Z"/>
      </svg>
      <span>X</span>
    </a>
    <a class="social-link" href="https://www.instagram.com/tsumugistudio_games/" target="_blank" rel="noopener" aria-label="Instagram">
      <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
        <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7Zm5 3.5A5.5 5.5 0 1 1 6.5 13 5.5 5.5 0 0 1 12 7.5Zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5Zm6.25-3.25a1.25 1.25 0 1 1-1.25 1.25 1.25 1.25 0 0 1 1.25-1.25Z"/>
      </svg>
      <span>Instagram</span>
    </a>
  </div>
  </footer>

  <script>
    // --- Utilities ---
    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));

    // Format dates
    function formatJa(dateStr){
      const d = new Date(dateStr+'T00:00:00');
      const y=d.getFullYear(), m=d.getMonth()+1, da=d.getDate();
      return `${y}年${m}月${da}日`;
    }
    function formatEn(dateStr){
      const d = new Date(dateStr+'T00:00:00');
      const fmt = new Intl.DateTimeFormat('en-US',{month:'short', day:'numeric', year:'numeric'}).format(d);
      return fmt.replace(',',''); // "Aug 25, 2025" -> "Aug 25 2025"
    }
    $$('.date-ja').forEach(el=>{const v=el.getAttribute('data-date'); if(v) el.textContent = formatJa(v)});
    $$('.date-en').forEach(el=>{const v=el.getAttribute('data-date'); if(v) el.textContent = formatEn(v)});

    // --- Language tabs (ARIA) ---
    const langTablist = $('.tabs[role="tablist"]');
    const langTabs = $$('[role="tab"]', langTablist);
    const langPanels = $$('.tab-content');

    function activateLang(btn){
      langTabs.forEach(t=>{t.classList.remove('active'); t.setAttribute('aria-selected','false')});
      langPanels.forEach(p=>p.classList.remove('active'));
      btn.classList.add('active'); btn.setAttribute('aria-selected','true');
      $('#'+btn.getAttribute('aria-controls')).classList.add('active');

      // ★追加：タブ切替時の動画制御
      pauseAllVideos();
      requestAnimationFrame(()=>playVisibleVideos());

      // sync hash & remember
      const currentRegion = getActiveRegion(btn.id.endsWith('ja')?'ja':'en');
      setHash({lang: btn.id.endsWith('ja')?'ja':'en', region: currentRegion});
      localStorage.setItem('tsu_lang', btn.id.endsWith('ja')?'ja':'en');
    }

    langTabs.forEach(btn=>{
      btn.addEventListener('click', ()=>activateLang(btn));
      btn.addEventListener('keydown', e=>{
        if(e.key==='ArrowRight' || e.key==='ArrowLeft'){
          e.preventDefault();
          const i = langTabs.indexOf(document.activeElement);
          const ni = e.key==='ArrowRight' ? (i+1)%langTabs.length : (i-1+langTabs.length)%langTabs.length;
          langTabs[ni].focus();
        }
      });
    });

    // ====== ★ 動画の共通ハンドリング ======
    const videos = $$('.hero-video');
  
    function isActuallyVisible(el){
      // display:none など祖先の非表示も考慮
      if (!el.isConnected) return false;
      const rect = el.getBoundingClientRect();
      const inViewport = rect.width > 0 && rect.height > 0 &&
                         rect.bottom >= 0 && rect.right >= 0 &&
                         rect.top <= (window.innerHeight || document.documentElement.clientHeight) &&
                         rect.left <= (window.innerWidth || document.documentElement.clientWidth);
      // 祖先のdisplay:noneチェック（offsetParentは厳密ではないが十分実用）
      const notHiddenByCSS = !!el.offsetParent || window.getComputedStyle(el).position === 'fixed';
      return inViewport && notHiddenByCSS;
    }
  
    let io = null;
    if ('IntersectionObserver' in window){
      io = new IntersectionObserver((entries)=>{
        entries.forEach(({target, isIntersecting})=>{
          if (isIntersecting && isActuallyVisible(target)) {
            target.play().catch(()=>{});
          } else {
            target.pause();
          }
        });
      }, { threshold: 0.25 });
    }
  
    function wireAllVideos(){
      videos.forEach(v=>{
        // 念のため自動再生も許可（scriptが動かなくても再生されやすくする）
        v.setAttribute('autoplay','');
        v.setAttribute('muted','');
        v.setAttribute('playsinline','');
  
        if (io) io.observe(v);
        else v.play && v.play().catch(()=>{});
      });
    }
  
    function pauseAllVideos(){ videos.forEach(v=>v.pause()); }
  
    function playVisibleVideos(){
      videos.forEach(v=>{
        if (isActuallyVisible(v)) { v.play().catch(()=>{}); }
      });
    }

    // --- Region tabs per language (ARIA) ---
    function wireRegion(group){
      const scope = group.dataset.scope; // 'ja' or 'en'
      const tabs = $$('.region-tab', group);
      const panels = $$('.region-panel', $('#content-'+scope));
      tabs.forEach(t=>{
        t.addEventListener('click', ()=>activateRegion(scope, t));
        t.addEventListener('keydown', e=>{
          if(e.key==='ArrowRight' || e.key==='ArrowLeft'){
            e.preventDefault();
            const i = tabs.indexOf(document.activeElement);
            const ni = e.key==='ArrowRight' ? (i+1)%tabs.length : (i-1+tabs.length)%tabs.length;
            tabs[ni].focus();
          }
        });
      });
      function activateRegion(scope, btn){
        tabs.forEach(b=>{b.classList.remove('active'); b.setAttribute('aria-selected','false')});
        panels.forEach(p=>p.classList.remove('active'));
        btn.classList.add('active'); btn.setAttribute('aria-selected','true');
        $('#'+btn.getAttribute('aria-controls')).classList.add('active');
        
        // ★追加：地域タブ切替時の動画制御
        pauseAllVideos();
        requestAnimationFrame(()=>playVisibleVideos());
        
        // sync hash & remember
        const lang = scope; const region = btn.dataset.region;
        setHash({lang, region});
        localStorage.setItem('tsu_region_'+lang, region);
      }
    }
    $$('.region-tabs').forEach(wireRegion);

    // --- Hash deep links: #lang=ja&region=hk ---
    function parseHash(){
      const h = location.hash.replace('#','');
      const params = new URLSearchParams(h);
      const lang = params.get('lang');
      const region = params.get('region');
      return {lang, region};
    }
    function setHash({lang, region}){
      const params = new URLSearchParams();
      if(lang) params.set('lang', lang);
      if(region) params.set('region', region);
      history.replaceState(null, '', '#'+params.toString());
    }

    function getActiveRegion(lang){
      const group = $(`.region-tabs[data-scope="${lang}"]`);
      const active = group ? group.querySelector('.region-tab.active') : null;
      return active ? active.dataset.region : 'hk';
    }

    // Initial state: from hash -> localStorage -> defaults
    (function init(){
      wireAllVideos(); // ★追加：まず全動画を監視対象に
      
      const {lang, region} = parseHash();
      const storedLang = localStorage.getItem('tsu_lang');
      const initLang = lang || storedLang || 'ja';
      // activate language
      const targetLangTab = initLang==='en' ? $('#tab-en') : $('#tab-ja');
      if(targetLangTab) activateLang(targetLangTab);

      // region (per current lang)
      const rKey = 'tsu_region_'+initLang;
      const storedRegion = localStorage.getItem(rKey);
      const initRegion = region || storedRegion || 'hk';
      const regionBtn = $(`#${initLang}-tab-${initRegion}`);
      if(regionBtn){ regionBtn.click(); }
      else { setHash({lang:initLang}); }

      // ★追加：初期表示で見えている動画を再生
      requestAnimationFrame(()=>playVisibleVideos());
    })();
    
  </script>
</body>
</html>
























